<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ë©”ëª¨ ë³´ë“œ ëª©ë¡</title>
    <link th:href="@{/css/pageSample.css?ver=1}" rel="stylesheet">
    <link th:href="@{/css/paging.css?ver=1}" rel="stylesheet">
    <script src="https://kit.fontawesome.com/047f82d071.js" crossorigin="anonymous"></script>
</head>
<body>
<header class="header-nav">
        <span class="header-flex-box header-logo">

            <span class="sidebar-action-border">
                <img th:src="@{/img/header_sidebar.png}" id="sidebar-action-icon">
            </span>
            <a href="/dashboard">UWS System</a>
        </span>

    <span class="header-pageName header-flex-box" >ë©”ëª¨ ëª©ë¡</span><!-- í˜„ì¬ í˜ì´ì§€ ì´ë¦„ -->

    <span class="header-flex-box">
            <span class="header-flex-three">
                <span class="header-icon">
                    <a href="#"><img th:src="@{/img/help.png}" id="help_icon"></a>
                    <a href="#" ><img th:src="@{/img/chart.png}" id="chart_icon"></a>
                    <a href="#" class="nowPage"><img th:src="@{/img/memo.png}" id="memo_icon"></a>
                </span>
                <img th:src="@{/img/profileImg.png}" id="profile-img">
                <span id="submenu-trigger">
                    <a href="#">Nacamora</a>
                    <div id="submenu">
                        <a href="#">ì •ë³´ ë³€ê²½</a>
                        <a href="#">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
                        <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                </span>
            </span>
        </span>
</header>
<main>
    <div class="mainPaging">
        <div class="memoListText">
            Memo ëª©ë¡
        </div>
        <div class="searchAndFilter">
            <div class= "radioGroup" id="dashboardFilterRadioGroup">
                <input type="radio" name="dashboardFilter" value="all" checked onclick="filterMemos()">ì „ì²´
                <input type="radio" name="dashboardFilter" value="Y" onclick="filterMemos()">Y
                <input type="radio" name="dashboardFilter" value="N" onclick="filterMemos()">N
            </div>
            <div class="searchGroup">
                    <select id="type" name="searchType">
                        <option value="entire">ì „ì²´</option>
                        <option value="contents">ë‚´ìš©</option>
                        <option value="writer">ì‘ì„±ì</option>
                    </select>
                    <input type="text" id="search_box" value="" placeholder="ğŸ”ï¸  ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”">
                    <button class="searchButton" onclick="searchMemo()">ê²€ìƒ‰</button>
            </div>
        </div>
        <div class="modify_buttons">
            <button class="writeButton" onclick="saveReq()">ì‘ì„±</button>
            <span>&nbsp;&nbsp;</span>
            <button class="deleteButton" onclick="deleteReq()">ì‚­ì œ</button>
        </div>
        <div class="memoListTable">
            <table class="memoListTable2">
                <tbody>
                <tr>
                    <th>
                        <input type="checkbox" id="allCheckBox" onclick="allChecked()">
                    </th>
                    <th>No.</th>
                    <th>ë‚´ìš©</th>
                    <th>ëŒ€ì‹œë³´ë“œ ë…¸ì¶œ</th>
                    <th>ì‘ì„±ì</th>
                    <th>ì‘ì„±ì¼</th>
                </tr>
                <tr style="text-align:center"  th:each="memo: ${MemoList}" class="memo">
                    <td>
                        <input type="checkbox" name="chk" class="chk" onclick="chkClicked()" th:value="${memo.id}">
                    </td>
                    <td> <a th:href="@{|/memo/${memo.id}|(page=${MemoList.number + 1})}" th:text="${memo.id}"></a></td>
                    <td> <a th:href="@{|/memo/${memo.id}|(page=${MemoList.number + 1})}" th:text="${memo.memoContents}" ></a></td>
                    <td> <a th:href="@{|/memo/${memo.id}|(page=${MemoList.number + 1})}" th:text="${memo.memoExposeYn}" ></a></td>
                    <td> <a th:href="@{|/memo/${memo.id}|(page=${MemoList.number + 1})}" th:text="${memo.userName}" ></a></td>
                    <td> <a th:href="@{|/memo/${memo.id}|(page=${MemoList.number + 1})}" th:text="${#temporals.format(memo.createTime, 'yyyy-MM-dd / HH:mm:ss')}"></a></td>
                </tr>
                </tbody>
            </table>
        </div>
    <div class="count">
     (ë°ì´í„° ì´<span th:text="${memoCount}"></span>ê±´)
    </div>

    <div class="pageButtons">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <!-- ì´ì „ í˜ì´ì§€ -->
                    <li th:if="${MemoList.hasPrevious()}" class="page-item">
                        <a class="page-link" th:href="@{'/memo/paging?page=' + (${MemoList.getNumber()} - 1) + '&amp;size=' + ${MemoList.getSize()} + '&amp;keyword=' + ${keyword != null ? keyword : ''} + '&amp;columnName=' + ${columnName != null ? columnName : ''}}" aria-label="Previous">
                            <span aria-hidden="true"> << </span>
                        </a>
                    </li>
                    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                    <li th:each="i : ${#numbers.sequence((MemoList.number - 3) < 0 ? 0 : (MemoList.number - 3), (MemoList.number + 3) > (MemoList.totalPages - 1) ? (MemoList.totalPages - 1) : (MemoList.number + 3))}" th:class="${MemoList.number == i} ? 'page-item active' : 'page-item'">
                        <a class="page-link" th:href="@{'/memo/paging?page=' + ${i} + '&amp;size=' + ${MemoList.getSize()} + '&amp;keyword=' + ${keyword != null ? keyword : ''} + '&amp;columnName=' + ${columnName != null ? columnName : ''}}" th:text="${i + 1}"></a>
                    </li>
                    <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                    <li th:if="${MemoList.hasNext()}" class="page-item">
                        <a class="page-link" th:href="@{'/memo/paging?page=' + (${MemoList.getNumber()} + 1) + '&amp;size=' + ${MemoList.getSize()} + '&amp;keyword=' + ${keyword != null ? keyword : ''} + '&amp;columnName=' + ${columnName != null ? columnName : ''}}" aria-label="Next">
                            <span aria-hidden="true"> >> </span>
                        </a>
                    </li>
                </ul>
            </nav>
    </div>
    </div>
</main>
<aside>
    <span id="sidebar">
        <nav>
            <ul class="sidebar-ul">
                <li onclick="location.href='/dashboard'" > <!-- í˜„ì¬ í˜ì´ì§€ ì˜ í•´ë‹¹í•˜ëŠ” spaníƒœê·¸ì— style="color: blue;" ì¨ì£¼ì„¸ì—¬  -->
                    <span class="nowPage">
                        <img th:src="@{/img/sidebar_dashboard.png}" id="sidebar_dashboard_icon">
                        <span class="sidebar-nav-text">DashBoard</span>
                    </span>
                    <i class="fa-solid fa-chevron-right"></i>
                </li>
                <li onclick="location.href='/insert_form'">
                    <span>
                        <img th:src="@{/img/sidebar_card.png}" id="sidebar_card_icon">
                        <span class="sidebar-nav-text">ê²°ì œë“±ë¡</span>
                    </span>
                    <i class="fa-solid fa-chevron-right"></i>
                </li>
                <li id="payList-toggle">
                    <span>
                        <img th:src="@{/img/sidebar_payList.png}" id="sidebar_payList_icon">
                        <span class="sidebar-nav-text">ê²°ì œëª©ë¡</span>
                    </span>
                    <i class="fa-solid fa-chevron-down"></i>
                </li>
                <li class="payList-nav" onclick="location.href='/list'">
                    <span class="payList">
                        <i class="fa-solid fa-square fa-2xs"></i>
                        <span class="sidebar-nav-text">ì „ì²´ ê²°ì œ ëª©ë¡</span>
                    </span>
                    <!-- <i class="fa-solid fa-chevron-right"></i> -->
                </li>
                <li class="payList-nav" onclick="location.href='/autoList'">
                    <span class="payList">
                        <i class="fa-solid fa-square fa-2xs"></i>
                        <span class="sidebar-nav-text" >ìë™ ê²°ì œ ëª©ë¡</span>
                    </span>
                    <!-- <i class="fa-solid fa-chevron-right"></i> -->
                </li>
            </ul>
        </nav>
    </span>
</aside>
</body>
<script th:src="@{/js/pageSample.js}"></script>
<script>
    function searchMemo() {
        var searchType = document.getElementById("type").value; // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…
        var keyword = document.getElementById("search_box").value; // ê²€ìƒ‰ì–´

        // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ ì»¬ëŸ¼ ëª…ì„ ì„¤ì •
        var columnName = ''; // ê²€ìƒ‰í•  ì»¬ëŸ¼ ëª…ì„ ì €ì¥í•  ë³€ìˆ˜
        if (searchType === 'contents') {
            columnName = 'memoContents';
        } else if (searchType === 'writer') {
            columnName = 'userName';
        }

        // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ URLì„ ìƒì„±í•˜ì—¬ í˜ì´ì§€ë¥¼ ì´ë™
        var url = '/memo/paging?page=0&size=10&columnName=' + columnName + '&keyword=' + keyword;

        // í˜ì´ì§€ ì´ë™
        window.location.href = url;
    }

    // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
    window.onload = function() {
        // ì´ì „ì— ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ ê°’ ê°€ì ¸ì˜¤ê¸°
        var selectedFilter = localStorage.getItem('selectedFilter');
        if (selectedFilter) {
            // ì €ì¥ëœ ê°’ì´ ìˆì„ ê²½ìš° í•´ë‹¹ ë²„íŠ¼ ì„ íƒ
            document.querySelector('input[value="' + selectedFilter + '"]').checked = true;
        }
    };


    function filterMemos() {
        // ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ì˜ ê°’ ê°€ì ¸ì˜¤ê¸°
        var dashboardFilterRadioGroup = document.getElementsByName("dashboardFilter");
        var keyword;
        for (var i = 0; i < dashboardFilterRadioGroup.length; i++) {
            if (dashboardFilterRadioGroup[i].checked) {
                keyword = dashboardFilterRadioGroup[i].value;
                break;
            }
        }

        // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ ì»¬ëŸ¼ ëª… ì„¤ì •
        var columnName = 'memoExposeYn';
        // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ ì»¬ëŸ¼ ëª… ì„¤ì •
        if (keyword === 'Y' || keyword === 'N') {
            columnName = 'memoExposeYn';
        }

        // ì„ íƒëœ ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ URLì„ ìƒì„±í•˜ì—¬ í˜ì´ì§€ë¥¼ ì´ë™
        var url = '/memo/paging?page=0&size=10&columnName=' + columnName + '&keyword=' + keyword;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì„ íƒëœ ê°’ì„ ì €ì¥
        localStorage.setItem('selectedFilter', keyword);

        // í˜ì´ì§€ ì´ë™
        window.location.href = url;
    }

    // ------------
    function allChecked(target){

         //ì „ì²´ ì²´í¬ë°•ìŠ¤ ë²„íŠ¼
         const checkbox = document.getElementById('allCheckBox');

         //ì „ì²´ ì²´í¬ë°•ìŠ¤ ë²„íŠ¼ ì²´í¬ ì—¬ë¶€
         const is_checked = checkbox.checked;

         //ì „ì²´ ì²´í¬ë°•ìŠ¤ ì œì™¸í•œ ëª¨ë“  ì²´í¬ë°•ìŠ¤
         if(is_checked){
             //ì²´í¬ë°•ìŠ¤ ì „ì²´ ì²´í¬
             chkAllChecked()
         }

         else{
             //ì²´í¬ë°•ìŠ¤ ì „ì²´ í•´ì œ
             chkAllUnChecked()
         }
     }

     //ìì‹ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
     function chkClicked(){

         //ì²´í¬ë°•ìŠ¤ ì „ì²´ê°œìˆ˜
         const allCount = document.querySelectorAll(".chk").length;

         //ì²´í¬ëœ ì²´í¬ë°•ìŠ¤ ì „ì²´ê°œìˆ˜
         const query = 'input[name="chk"]:checked'
         const selectedElements = document.querySelectorAll(query)
         const selectedElementsCnt = selectedElements.length;

         //ì²´í¬ë°•ìŠ¤ ì „ì²´ê°œìˆ˜ì™€ ì²´í¬ëœ ì²´í¬ë°•ìŠ¤ ì „ì²´ê°œìˆ˜ê°€ ê°™ìœ¼ë©´ ì „ì²´ ì²´í¬ë°•ìŠ¤ ì²´í¬
         if(allCount == selectedElementsCnt){
              document.getElementById('allCheckBox').checked = true;
         }

         //ê°™ì§€ì•Šìœ¼ë©´ ì „ì²´ ì²´í¬ë°•ìŠ¤ í•´ì œ
         else{
             document.getElementById('allCheckBox').checked = false;
         }
     }

     //ì²´í¬ë°•ìŠ¤ ì „ì²´ ì²´í¬
     function chkAllChecked(){
         document.querySelectorAll(".chk").forEach(function(v, i) {
             v.checked = true;
         });
     }

     //ì²´í¬ë°•ìŠ¤ ì „ì²´ ì²´í¬ í•´ì œ
     function chkAllUnChecked(){
         document.querySelectorAll(".chk").forEach(function(v, i) {
             v.checked = false;
         })
     }

<!--   function search(f){-->
<!--        var type = f.type.value;-->

<!--        f.action = "/memo/search";-->
<!--        f.method = "post";-->
<!--        f.submit();-->
<!--   }-->

    const saveReq = () => {
        location.href = "/memo/save";
    }

   function deleteReq() {

         const selectedIds = [];
         const checkboxes = document.querySelectorAll('.chk:checked');
         checkboxes.forEach((chk) => {
             selectedIds.push(chk.value);
             console.log("check", chk.value);
             console.log("selectedIds", selectedIds);
         });

         if (selectedIds.length === 0) {
             alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
             return;
         }

         // Ajax ìš”ì²­ìœ¼ë¡œ ì„ íƒëœ í•­ëª©ì˜ IDë¥¼ ì„œë²„ë¡œ ì „ì†¡
         fetch('/memo/delete', {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json'
             },
             body: JSON.stringify(selectedIds)
         })
         .then(response => {
             if (response.ok) {

                 console.log('Selected items deleted successfully.');
                 location.reload(true);

                 // ì‚­ì œ ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” í•„ìš”í•œ ì²˜ë¦¬
             } else {
                 console.error('Error occurred while deleting selected items.');
             }
         })
         .catch(error => {
             console.error('Error occurred while deleting selected items:', error);
         });
   }

// MemoListë¥¼ ê°€ì ¸ì˜¤ëŠ” AJAX ìš”ì²­
function getTotalPosts() {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                var totalPostsDiv = document.getElementById("totalPosts");
                var totalPosts = xhr.responseText;
                totalPostsDiv.textContent = "(ì´ " + totalPosts + "ê±´ì˜ ê²Œì‹œê¸€)";
            } else {
                console.error('Request failed');
            }
        }
    };
    xhr.open("GET", "/memo/totalPosts", true);
    xhr.send();
}

</script>

</html>
