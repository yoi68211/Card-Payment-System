<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/insert_form.css">
    <script src="/js/insert_form.js"></script>
    <script>
        function send(f) {
      var documentNo = f.documentNo.value;
      var createTime = f.createTime.value;
      var name = f.name.value;
      var email = f.email.value;
      var phone = f.phone.value;
      var address = f.address.value;
      var title = f.title.value;
      var type = f.type.checked ? "자동결제" : "일반결제";
      var firstPay = f.firstPay.checked ? "처음결제금액" : "다름";
      var bizTo = f.bizTo.value;
      var cycle = f.cycle.value;
      var paymentDate = f.paymentDate.value;
      var pay = f.pay.value;
      var memo = f.memo.value;

      var productList = [];
      var productRows = document.querySelectorAll("#product tbody tr");
      for (var i = 1; i < productRows.length - 1; i++) {
          var productName = productRows[i].querySelector("input[name^='productList']").value;
          var totalItems = productRows[i].querySelector("input[name^='productList'][name$='totalItems']").value;
          var price = productRows[i].querySelector("input[name^='productList'][name$='price']").value;
          productList.push({ productName: productName, totalItems: totalItems, price: price });
      }

      var data = {
          documentNo: documentNo,
          createTime: createTime,
          name: name,
          email: email,
          phone: phone,
          address: address,
          title: title,
          type: type,
          firstPay: firstPay,
          bizTo: bizTo,
          cycle: cycle,
          paymentDate: paymentDate,
          pay: pay,
          memo: memo,
          productList: productList
      };

      // JSON 데이터를 서버에 전송
      fetch('/insert', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
      }).then(response => {
          if (response.ok) {
              // 요청이 성공적으로 처리되었을 때의 동작
              console.log('Request succeeded');
          } else {
              // 요청이 실패했을 때의 동작
              console.error('Request failed');
          }
      }).catch(error => {
          console.error('Error:', error);
      });
  }

                  function addRow() {
                      var table = document.getElementById("product");
                      var rowCount = table.rows.length;
                      var row = table.insertRow(rowCount - 1);
                      var checkBoxCell = row.insertCell(0);
                      var productNameCell = row.insertCell(1);
                      var totalItemsCell = row.insertCell(2);
                      var priceCell = row.insertCell(3);
                      var resCell = row.insertCell(4);

                      checkBoxCell.innerHTML = "<input type='checkbox'>";
                      productNameCell.innerHTML = "<input type='text' name='productList[" + (rowCount - 2) + "].productName'>";
                      totalItemsCell.innerHTML = "<input type='text' name='productList[" + (rowCount - 2) + "].totalItems' oninput='updatetotalItems(this.parentNode.parentNode)'>";
                      priceCell.innerHTML = "<input type='text' name='productList[" + (rowCount - 2) + "].price' oninput='updatePrice(this.parentNode.parentNode)'>";
                      resCell.id = "res";
                  }

                  function toggleAllCheckboxes() {
                      var masterCheckbox = document.getElementById('masterCheckbox');
                      var checkboxes = document.querySelectorAll("#product input[type='checkbox']");
                      checkboxes.forEach(function(checkbox) {
                          checkbox.checked = masterCheckbox.checked;
                      });
                  }

                  window.addEventListener('DOMContentLoaded', function() {
                      document.getElementById('masterCheckbox').addEventListener('click', toggleAllCheckboxes);
                  });
    </script>
</head>
<body>
<form id="paymentForm">
    결제등록
    <input type="button" value="이전저장글">
    <input type="button" value="임시저장">
    <br>
    <table border="1">
        <caption>기본 결제 등록</caption>
        <tr>
            <th><label for="documentNo">문서번호</label></th>
            <th><input type="text" id="documentNo" name="documentNo"></th>
            <th><label for="createTime">작성일</label></th>
            <th><input type="date" id="createTime" name="createTime"></th>
        </tr>
        <tr>
            <th><label for="name">고객명</label></th>
            <th><input type="text" id="name" name="name"></th>
            <th><label for="email">이메일</label></th>
            <th><input type="text" id="email" name="email"></th>
        </tr>
        <tr>
            <th><label for="phone">연락처</label></th>
            <th><input type="text" id="phone" name="phone"></th>
            <th><label for="address">주소</label></th>
            <th><input type="text" id="address" name="address"></th>
        </tr>
        <tr>
            <th><label for="title">제목</label></th>
            <th colspan="3"><input type="text" id="title" name="title"></th>
        </tr>
        <tr>
            <th>결제설정</th>
            <th>
                <input type="checkbox" id="type" name="type" value="자동결제">
                <label for="type">자동결제</label>
                <input type="button" value="!">
                <input type="checkbox" id="firstPay" name="firstPay" value="처음결제금액">
                <label for="firstPay">처음결제금액</label>
                <input type="button" value="!">
            </th>
            <th>결제구분</th>
            <th>
                <label><input type="radio" name='bizTo' value='BTOC'/>B TO C</label>
                <label><input type='radio' name='bizTo' value='BTOB'/>B TO B</label>
            </th>
        </tr>
        <tr>
            <th>자동결제 주기</th>
            <th>
                <label for="cycle"><select id="cycle" name="cycle">
                    <option>다음달</option>
                    <option>다다음달</option>
                </select></label>
                <label for="paymentDate"><input type="text" id="paymentDate" name="paymentDate"></label>  일
                <label for="pay"><input type="text" id="pay" name="pay"></label> 엔
            </th>
        </tr>
        <tr>
            <th colspan="4"><label for="memo"><textarea cols="150" rows="10" id="memo" name="memo"></textarea></label></th>
        </tr>
    </table>

    결제물품정보등록
    <input type="button" value="+행추가" onclick="addRow()">
    <input type="button" value="-행삭제" id="deleteRow_btn" onclick='deleteRow(-1)' disabled>
    <table border="1" id="product">
        <tr>
            <th>
                <input type="checkbox" id="masterCheckbox">
                <label for="masterCheckbox"></label>
            </th>
            <th>상품명</th>
            <th>수량</th>
            <th>단가</th>
            <th>금액</th>
        </tr>
        <tr>
            <th>
                <input type="checkbox">
            </th>
            <th><input type=text id="productName" name="productList[0].productName"></th>
            <th><input type="text" id="totalItems" name="productList[0].totalItems" oninput="updatetotalItems(this.parentNode.parentNode)"></th>
            <th><input type="text" id="price" name="productList[0].price" oninput="updatePrice(this.parentNode.parentNode)"></th>
            <th id="res"></th>
        </tr>
        <tr>
            <th></th>
            <th>합계</th>
            <th id="totaltotalItems"></th>
            <th id="totalPrice"></th>
            <th id="final"></th>
        </tr>
    </table>
    <input type="button" value="등록" onclick="send(this.form)">
</form>
</body>
<script>document.getElementById('createTime').value = new Date().toISOString().substring(0, 10);</script>
</html>
