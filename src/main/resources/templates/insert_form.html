<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/css/pageSample.css}" rel="stylesheet">
    <script src="https://kit.fontawesome.com/047f82d071.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/insert_form.css">
    <script src="/js/insert_form.js"></script>
    <script>
        function save(){
            var before = document.getElementById("before");

            var f = document.getElementById('paymentForm');
            var name = f.customerName.value;
            var email = f.customerEmail.value;
            var phone = f.customerPhone.value;
            var address = f.customerAddress.value;
            var title = f.paymentTitle.value;
            var type = f.paymentType.checked ? "auto" : "basic";
            var firstPayCheck = f.firstPay_check.checked ? 1 : 0;
            var bizTo = f.paymentBizTo.value;

            var month = f.paymentMonth.value == "다음달" ? 1 : 2;
            var autoDate = f.autoDate.value;
            var paymentFirstPay = f.paymentFirstPay.value;

            var productRows = document.querySelectorAll("#product tbody tr");
            var productList = [];
            for (var i = 1; i < productRows.length - 1; i++) {
                var productName = productRows[i].querySelector("input[name='productName']").value;
                var totalItems = productRows[i].querySelector("input[name='productTotalItems']").value;
                var price = productRows[i].querySelector("input[name='productPrice']").value;

                productList.push({ s_productName: productName, s_productTotalItems: totalItems, s_productPrice: price});
            }
            var data = {
                s_paymentName: name,
                s_paymentEmail: email,
                s_paymentPhone: phone,
                s_paymentAddress: address,
                s_paymentTitle: title,
                s_paymentType: type,
                s_paymentFirstPay: firstPayCheck,
                s_paymentBizTo: bizTo,
                s_paymentCycle: month,
                s_paymentDate: autoDate,
                s_paymentPay: paymentFirstPay,
                productList: productList
            };

            // JSON 데이터를 서버에 전송
            fetch('/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    // 요청이 성공적으로 처리되었을 때의 동작
                    console.log('Request succeeded');
                    alert('임시저장 성공!');
                    before.disabled = false;
                } else {
                    // 요청이 실패했을 때의 동작
                    console.error('Request failed');
                    before.disabled = true;
                }
            }).catch(error => {
                console.error('Error:', error);
            });
        }
        function load(){

        }
    </script>
</head>
<body>
<header class="header-nav">
        <span class="header-flex-box">
            <i class="fa-solid fa-list" id="sidebar-action-icon"></i>
             <a href="/dashboard">AIP System</a>
        </span>

    <span class="header-pageName header-flex-box" >DashBoard</span><!-- 현재 페이지 이름 -->

    <span class="header-flex-box">
            <span class="header-flex-three">
                <span class="header-icon">
                    <a href="#"><i class="fa-solid fa-circle-question fa-xl"></i></a>
                    <a href="#"><i class="fa-solid fa-comment-dots fa-xl"></i></i></a>

                </span>
                <img th:src="@{/img/defaultImg.png}" id="profile-img">
                <span id="submenu-trigger">
                    <a href="#">Nacamora</a>
                    <div id="submenu">
                        <a href="#">정보 변경</a>
                        <a href="#">비밀번호 변경</a>
                        <a href="/logout">로그아웃</a>
                    </div>
                </span>
            </span>
        </span>
</header>
<main>
<form id="paymentForm">
    결제등록
    <input type="button" id="before" value="이전저장글" onclick="load()" disabled>
    <input type="button" value="임시저장" onclick="save()">
    <br>
    <table border="1">
        <caption>기본 결제 등록</caption>
<!--        <tr>-->
<!--            <th><label for="documentNo">문서번호</label></th>-->
<!--            <th><input type="text" id="documentNo" name="documentNo"></th>-->
<!--            <th><label for="paymentCreateTime">작성일</label></th>-->
<!--            <th><input type="datetime-local" id="paymentCreateTime" name="paymentCreateTime"></th>-->
<!--        </tr>-->
        <tr>
            <th><label for="customerName">고객명</label></th>
            <th><input type="text" id="customerName" name="customerName"></th>
            <th><label for="customerEmail">이메일</label></th>
            <th><input type="text" id="customerEmail" name="customerEmail"></th>
        </tr>
        <tr>
            <th><label for="customerPhone">연락처</label></th>
            <th><input type="text" id="customerPhone" name="customerPhone"></th>
            <th><label for="customerAddress">주소</label></th>
            <th><input type="text" id="customerAddress" name="customerAddress"></th>
        </tr>
        <tr>
            <th><label for="paymentTitle">제목</label></th>
            <th colspan="3"><input type="text" id="paymentTitle" name="paymentTitle"></th>
        </tr>
        <tr>
            <th>결제설정</th>
            <th>
                <input type="checkbox" id="paymentType" name="paymentType" value="자동결제" onclick="cycle()">
                <label for="paymentType">자동결제</label>
                <input type="button" value="!">
                <input type="checkbox" id="firstPay_check" name="firstPay_check" disabled>
                <label for="firstPay_check">처음결제금액</label>
                <input type="button" value="!">
            </th>
            <th>결제구분</th>
            <th>
                <label><input type="radio" name='paymentBizTo' value='BtoC' checked/>B TO C</label>
                <label><input type='radio' name='paymentBizTo' value='BtoB'/>B TO B</label>
            </th>
        </tr>
        <tr>
            <th>자동결제 주기</th>
            <th>
                <label for="paymentMonth"><select id="paymentMonth" name="paymentMonth" disabled>
                    <option>다음달</option>
                    <option>다다음달</option>
                </select></label>
                <label for="autoDate"><input type="text" id="autoDate" name="autoDate" disabled></label>  일
                <label for="paymentFirstPay"><input type="text" id="paymentFirstPay" name="paymentFirstPay" disabled></label> 엔
            </th>
        </tr>
    </table>

    결제물품정보등록
    <input type="button" value="+행추가" onclick="addRow()">
    <input type="button" value="-행삭제" id="deleteRow_btn" onclick='deleteRow(-1)' disabled>
    <table border="1" id="product">
        <tr>
            <th>
                <input type="checkbox" id="masterCheckbox">
                <label for="masterCheckbox"></label>
            </th>
            <th>상품명</th>
            <th>수량</th>
            <th>단가</th>
            <th>금액</th>
        </tr>
        <tr>
            <th>
                <input type="checkbox">
            </th>
            <th><input type=text id="productName" name="productName"></th>
            <th><input type="text" id="productTotalItems" name="productTotalItems" oninput="updatetotalItems(this.parentNode.parentNode)"></th>
            <th><input type="text" id="productPrice" name="productPrice" oninput="updatePrice(this.parentNode.parentNode)"></th>
            <th><input type="text" id="productAmount" name="productAmount" readonly></th>
        </tr>
        <tr>
            <th></th>
            <th>합계</th>
            <th id="totaltotalItems"></th>
            <th id="totalPrice"></th>
            <th id="final"></th>
        </tr>
    </table>
    <input type="button" value="등록" onclick="send()">
</form>
</main>
<aside>
        <span id="sidebar">
            <nav>
                <ul>
                    <li> <!-- 현재 페이지 의 해당하는 span태그에 style="color: blue;" 써주세여  -->
                        <span style="color: blue;">
                            <i class="fa-solid fa-table-cells"></i>
                            <span class="sidebar-nav-text">DashBoard</span>
                        </span>
                        <i class="fa-solid fa-chevron-right"></i>
                    </li>
                    <li onclick="location.href='/insert_form'">
                        <span>
                            <i class="fa-solid fa-credit-card"></i>
                            <span class="sidebar-nav-text">결제등록</span>
                        </span>
                        <i class="fa-solid fa-chevron-right"></i>
                    </li>
                    <li>
                        <span>
                            <i class="fa-solid fa-rectangle-list"></i>
                            <span class="sidebar-nav-text">결제목록</span>
                        </span>
                        <i class="fa-solid fa-chevron-down" id="payList-toggle"></i>
                    </li>
                    <li class="payList-nav">
                        <span class="payList">
                            <i class="fa-solid fa-square fa-2xs"></i>
                            <span class="sidebar-nav-text">전체 결제 목록</span>
                        </span>
                        <!-- <i class="fa-solid fa-chevron-right"></i> -->
                    </li>
                    <li class="payList-nav">
                        <span class="payList">
                            <i class="fa-solid fa-square fa-2xs"></i>
                            <span class="sidebar-nav-text" ><a href="/autoPayListDetail">자동 결제 목록</a></span>
                        </span>
                        <!-- <i class="fa-solid fa-chevron-right"></i> -->
                    </li>

                </ul>
            </nav>
            </span>
</aside>
</body>
<script th:src="@{/js/pageSample.js}"></script>
</html>
